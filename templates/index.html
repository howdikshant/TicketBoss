<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TicketBoss üéüÔ∏è</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #0f0f0f;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        header {
            background: #00b894;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        main {
            padding: 20px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .box {
            background: #1e1e1e;
            padding: 20px;
            border-radius: 12px;
            width: 280px;
            box-shadow: 0 0 8px rgba(0, 255, 180, 0.3);
        }

        input, button {
            padding: 8px;
            margin: 6px 0;
            border-radius: 8px;
            border: none;
            width: 90%;
        }

        button {
            background: #00b894;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        button:hover {
            background: #019874;
        }

        .output-area {
            background: #111;
            border-radius: 12px;
            padding: 15px;
            width: 80%;
            max-width: 700px;
            margin: 0 auto;
            max-height: 400px;
            overflow-y: auto;
            text-align: left;
            box-shadow: inset 0 0 8px rgba(0,255,180,0.2);
        }

        .msg {
            background: #222;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            white-space: pre-wrap;
            line-height: 1.3;
        }

        .success { border-left: 4px solid #00b894; }
        .error { border-left: 4px solid #e74c3c; }
        .info { border-left: 4px solid #3498db; }
    </style>
</head>
<body>
    <header>üéüÔ∏è TicketBoss ‚Äî Event Seat Booking</header>
    <main>
        <div class="controls">
            <div class="box">
                <h3>Reserve Seats</h3>
                <input id="partnerId" placeholder="Partner ID" />
                <input id="seats" placeholder="Seats" type="number" />
                <button onclick="reserve()">Reserve</button>
            </div>

            <div class="box">
                <h3>Cancel Reservation</h3>
                <input id="reservationId" placeholder="Reservation ID" />
                <button onclick="cancelRes()">Cancel</button>
            </div>

            <div class="box">
                <h3>View Event Summary</h3>
                <button onclick="getSummary()">Show Summary</button>
            </div>
        </div>

        <div class="output-area" id="output"></div>
    </main>

    <script>
        const API = "http://127.0.0.1:8000";

        function addMessage(text, type="info") {
            const box = document.createElement("div");
            box.className = "msg " + type;
            box.textContent = text;
            const output = document.getElementById("output");
            output.appendChild(box);
            output.scrollTop = output.scrollHeight; // auto-scroll to bottom
        }

        async function reserve() {
            const pid = document.getElementById("partnerId").value;
            const seats = parseInt(document.getElementById("seats").value);
            try {
                const res = await fetch(`${API}/reservations/`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ partnerId: pid, seats })
                });
                const data = await res.json();
                if (res.ok) addMessage(`‚úÖ Reserved ${data.seats} seats\nReservation ID: ${data.reservationId}`, "success");
                else addMessage(`‚ùå ${data.detail || data.error}`, "error");
            } catch (err) {
                addMessage(`‚ùå Network error: ${err}`, "error");
            }
        }

        async function cancelRes() {
            const id = document.getElementById("reservationId").value;
            try {
                const res = await fetch(`${API}/reservations/${id}`, { method: "DELETE" });
                if (res.status === 204)
                    addMessage(`üóëÔ∏è Cancelled reservation: ${id}`, "success");
                else
                    addMessage(`‚ùå Reservation not found`, "error");
            } catch (err) {
                addMessage(`‚ùå Network error: ${err}`, "error");
            }
        }

        async function getSummary() {
            try {
                const res = await fetch(`${API}/reservations/`);
                const data = await res.json();
                addMessage(`üìä Summary:
Event: ${data.name}
Available Seats: ${data.availableSeats}
Reserved: ${data.reservationCount}
Version: ${data.version}`, "info");
            } catch (err) {
                addMessage(`‚ùå Could not fetch summary: ${err}`, "error");
            }
        }
    </script>
</body>
</html>
